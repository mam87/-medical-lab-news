<script>
    // Clock and Date
    function updateDateTime() {
        const now = new Date();
        const hours = String(now.getHours()).padStart(2, '0');
        const minutes = String(now.getMinutes()).padStart(2, '0');
        const seconds = String(now.getSeconds()).padStart(2, '0');
        document.getElementById('clock').textContent = `${hours}:${minutes}:${seconds}`;
        
        const options = { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' };
        const dateString = now.toLocaleDateString('ar-SA', options);
        document.getElementById('date').textContent = dateString;
        document.getElementById('lastUpdated').textContent = `آخر تحديث: ${dateString}`;
    }
    setInterval(updateDateTime, 1000);
    updateDateTime();

    // News Data - Built-in (No external files)
    const newsData = [
        {
            id: 1,
            title: "CDC تحقق في تفشي جديد لسلمونيلا شديدة المقاومة للأدوية",
            excerpt: "تحقق CDC وFDA في تفشي متعدد الولايات لسلمونيلا شديدة المقاومة للأدوية. المرضى يحتاجون اختبارات مخبرية متخصصة.",
            source: "CDC",
            sourceClass: "source-cdc",
            date: new Date().toLocaleDateString('ar-SA'),
            tag: "outbreak",
            tagClass: "tag-outbreak",
            tagName: "وبائي"
        },
        {
            id: 2,
            title: "WHO تطلق استراتيجية 2026 للتشخيصات الرقمية",
            excerpt: "منظمة الصحة العالمية تطلق مبادرة جديدة لنشر نقاط الرعاية التشخيصية في المناطق النائية مع ربط النتائج إلكترونياً.",
            source: "WHO",
            sourceClass: "source-who",
            date: new Date().toLocaleDateString('ar-SA'),
            tag: "tech",
            tagClass: "tag-tech",
            tagName: "تقني"
        },
        {
            id: 3,
            title: "FDA تعتمد اختبار HbA1c جديد في 50 ثانية فقط",
            excerpt: "حصلت Tosoh Bioscience على موافقة FDA 510(k) لمحلل جديد لفحص السكر التراكمي بدقة عالية.",
            source: "FDA",
            sourceClass: "source-fda",
            date: new Date().toLocaleDateString('ar-SA'),
            tag: "diagnostic",
            tagClass: "tag-diagnostic",
            tagName: "تشخيصي"
        },
        {
            id: 4,
            title: "تخفيضات Medicare تصل إلى 15% تهدد المختبرات",
            excerpt: "سارية المفعول: تخفيضات تصل إلى 15% في تعويضات Medicare للمختبرات بموجب قانون PAMA.",
            source: "CMS",
            sourceClass: "source-cdc",
            date: new Date().toLocaleDateString('ar-SA'),
            tag: "guideline",
            tagClass: "tag-guideline",
            tagName: "إرشادات"
        },
        {
            id: 5,
            title: "60% من كوادر المختبرات مؤهلة للتقاعد في 2026",
            excerpt: "تحذير عاجل: وفقاً لجمعية ASCLS، سيصل 60% من workforce المختبرات الطبية إلى سن التقاعد.",
            source: "ASCLS",
            sourceClass: "source-local",
            date: new Date().toLocaleDateString('ar-SA'),
            tag: "tech",
            tagClass: "tag-tech",
            tagName: "تقني"
        },
        {
            id: 6,
            title: "الذكاء الاصطناعي يتحول إلى شريك تشخيصي في 2026",
            excerpt: "تقرير Mayo Clinic: AI في المختبرات أصبح شريكاً تشخيصياً فعالاً وليس مجرد أداة مساعدة.",
            source: "Mayo Clinic",
            sourceClass: "source-local",
            date: new Date().toLocaleDateString('ar-SA'),
            tag: "tech",
            tagClass: "tag-tech",
            tagName: "تقني"
        }
    ];

    // Render News
    function renderNews(filter = 'all') {
        const container = document.getElementById('newsContainer');
        container.innerHTML = '';
        
        const filtered = filter === 'all' ? newsData : newsData.filter(item => item.tag === filter);
        
        filtered.forEach(item => {
            const card = document.createElement('div');
            card.className = 'news-card';
            card.innerHTML = `
                <div class="news-source ${item.sourceClass}">
                    <i class="fas fa-${item.source === 'WHO' ? 'globe' : item.source === 'FDA' ? 'shield-alt' : 'hospital'}"></i>
                    ${item.source}
                </div>
                <h3 class="news-title">${item.title}</h3>
                <p class="news-excerpt">${item.excerpt}</p>
                <div class="news-meta">
                    <span><i class="far fa-calendar-alt"></i> ${item.date}</span>
                    <span class="news-tag ${item.tagClass}">${item.tagName}</span>
                </div>
            `;
            container.appendChild(card);
        });
    }

    function filterNews(category) {
        document.querySelectorAll('.category-tag').forEach(tag => tag.classList.remove('active'));
        event.target.classList.add('active');
        renderNews(category);
    }

    // Initialize
    document.addEventListener('DOMContentLoaded', () => {
        renderNews();
        
        // Breaking News Rotation
        const breakingNews = [
            "CDC تحقق في تفشي جديد لسلمونيلا مقاومة للأدوية",
            "تحذير: تخفيضات Medicare 15% تهدد المختبرات",
            "أزمة: 60% من كوادر المختبرات مؤهلة للتقاعد",
            "FDA تعتمد اختبار HbA1c الجديد في 50 ثانية"
        ];
        
        let index = 0;
        setInterval(() => {
            index = (index + 1) % breakingNews.length;
            const banner = document.getElementById('breakingText');
            banner.style.opacity = '0';
            setTimeout(() => {
                banner.textContent = breakingNews[index];
                banner.style.opacity = '1';
            }, 300);
        }, 8000);
    });
</script>
